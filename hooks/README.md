# AI Code Review - Git Hooks

è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥çš„ Git Hooks é›†æˆæ–¹æ¡ˆã€‚

## åŠŸèƒ½

### 1. pre-commit
- âœ… ç›´æŽ¥é€šè¿‡ï¼Œä¸è¿›è¡Œå®¡æŸ¥
- âœ… commit é€Ÿåº¦å¿«ï¼Œä¸å½±å“å¼€å‘ä½“éªŒ

### 2. commit-msg
- âœ… ç›´æŽ¥é€šè¿‡ï¼Œä¸æ·»åŠ å®¡æŸ¥æ‘˜è¦
- âœ… commit é€Ÿåº¦å¿«

### 3. pre-pushï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- âœ… åœ¨ `git push` å‰ä¸¥æ ¼å®¡æŸ¥ä»£ç å˜æ›´
- âœ… åªå®¡æŸ¥æœ¬æ¬¡ä¿®æ”¹çš„ä»£ç ï¼ˆgit diffï¼‰ï¼Œä¸å®¡æŸ¥æ•´ä¸ªæ–‡ä»¶
- âœ… ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œè·¨çŽ¯å¢ƒå…¼å®¹
- âŒ å‘çŽ°ä¸¥é‡é—®é¢˜æ—¶ä¼šé˜»æ­¢æŽ¨é€
- âœ… éœ€è¦è¾“å…¥ `FORCE_PUSH` æ‰èƒ½å¼ºåˆ¶æŽ¨é€

## å®‰è£…

### 1. å¯åŠ¨ AI CR æœåŠ¡

```bash
cd ai-cr
go run main.go server
```

### 2. å®‰è£… Git Hooks

åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
cd /path/to/your/project
bash /path/to/ai-cr/hooks/install.sh
```

æˆ–è€…åœ¨ `safe-user-center` é¡¹ç›®ä¸­ï¼š

```bash
cd safe-user-center
bash ../ai-cr/hooks/install.sh
```

## ä½¿ç”¨

å®‰è£…åŽï¼ŒGit Hooks ä¼šè‡ªåŠ¨å·¥ä½œï¼š

### æäº¤ä»£ç ï¼ˆå¿«é€Ÿï¼Œæ— é˜»æ‹¦ï¼‰
```bash
git add .
git commit -m "fix: ä¿®å¤ç™»å½•é—®é¢˜"

# è¾“å‡º:
# [main abc1234] fix: ä¿®å¤ç™»å½•é—®é¢˜
#  2 files changed, 10 insertions(+), 5 deletions(-)
# 
# âœ… æäº¤æˆåŠŸï¼ˆæ— ä»»ä½•å®¡æŸ¥ï¼Œé€Ÿåº¦å¿«ï¼‰
```

### æŽ¨é€ä»£ç ï¼ˆä¸¥æ ¼å®¡æŸ¥ï¼‰
```bash
git push origin main

# è¾“å‡º:
# ðŸš€ AI Code Review - æŽ¨é€å‰ä¸¥æ ¼æ£€æŸ¥...
# ðŸ“ å‘çŽ°æœªæŽ¨é€çš„æäº¤:
# abc1234 fix: ä¿®å¤ç™»å½•é—®é¢˜
# 
# ðŸ“ é¡¹ç›®è·¯å¾„: /Users/chenyuhang/GolandProjects/safe-user-center
# ðŸ“ å˜æ›´çš„æ–‡ä»¶:
# controller/login.go
# model/login_model.go
# 
# ðŸ” èŽ·å–ä»£ç å˜æ›´...
# ðŸ“Š ä»£ç å˜æ›´å¤§å°: 1234 å­—ç¬¦
# 
# ðŸ” AI å®¡æŸ¥ä¸­ï¼ˆåªå®¡æŸ¥æœ¬æ¬¡ä¿®æ”¹çš„ä»£ç ï¼‰...
# 
# ðŸ“‹ AI å®¡æŸ¥ç»“æžœ:
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ## ä»£ç å®¡æŸ¥æŠ¥å‘Š
# 
# ### æœ¬æ¬¡ä¿®æ”¹å®¡æŸ¥
# 1. controller/login.go (ç¬¬177è¡Œ)
#    - âœ… æ­£ç¡®æ·»åŠ äº†é”™è¯¯å¤„ç†
# 2. model/login_model.go (ç¬¬234è¡Œ)
#    - âœ… æ·»åŠ äº† err æ£€æŸ¥
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# 
# âœ… AI å®¡æŸ¥é€šè¿‡ï¼Œå…è®¸æŽ¨é€
```

## é…ç½®

### è·³è¿‡å®¡æŸ¥

```bash
# è·³è¿‡ pre-push å®¡æŸ¥
git push --no-verify

# æˆ–åœ¨ push æ—¶è¾“å…¥ FORCE_PUSH å¼ºåˆ¶æŽ¨é€
```

### è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™

ç¼–è¾‘ pre-push hookï¼š

```bash
vim .git/hooks/pre-push

# ä¿®æ”¹å®¡æŸ¥é‡ç‚¹
è¯·é‡ç‚¹å…³æ³¨ï¼š
1. å®‰å…¨æ¼æ´žï¼ˆSQLæ³¨å…¥ã€XSSã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼‰
2. ä¸¥é‡çš„é€»è¾‘é”™è¯¯å’Œæ½œåœ¨ Bug
3. æ€§èƒ½é—®é¢˜
4. ä»£ç è§„èŒƒé—®é¢˜
```

### ç¦ç”¨ commit-msgï¼ˆå¦‚æžœ commit å¾ˆæ…¢ï¼‰

å¦‚æžœä½ çš„ commit å¾ˆæ…¢ï¼Œå¯èƒ½æ˜¯æ—§ç‰ˆæœ¬çš„ commit-msg hook åœ¨è°ƒç”¨ AIï¼š

```bash
# æ–¹æ¡ˆ1ï¼šæ›´æ–°ä¸ºæ–°ç‰ˆæœ¬
cat > .git/hooks/commit-msg << 'EOF'
#!/bin/bash
exit 0
EOF
chmod +x .git/hooks/commit-msg

# æ–¹æ¡ˆ2ï¼šç›´æŽ¥åˆ é™¤
rm .git/hooks/commit-msg
```

## å¸è½½

```bash
cd /path/to/your/project
bash /path/to/ai-cr/hooks/uninstall.sh
```

## æ³¨æ„äº‹é¡¹

1. **æœåŠ¡å¿…é¡»è¿è¡Œ**: push æ—¶éœ€è¦ AI CR æœåŠ¡åœ¨ `localhost:8083` è¿è¡Œ
2. **éœ€è¦ jq**: ç”¨äºŽè§£æž JSONï¼Œå®‰è£…: `brew install jq`
3. **commit å¾ˆå¿«**: pre-commit å’Œ commit-msg éƒ½ç›´æŽ¥é€šè¿‡ï¼Œä¸å½±å“é€Ÿåº¦
4. **push ä¼šå®¡æŸ¥**: åªåœ¨ push æ—¶è¿›è¡Œä¸¥æ ¼å®¡æŸ¥ï¼Œå®¡æŸ¥æœ¬æ¬¡ä¿®æ”¹çš„ä»£ç 
5. **ç½‘ç»œ**: éœ€è¦è°ƒç”¨ DeepSeek APIï¼Œç¡®ä¿ç½‘ç»œç•…é€š
6. **ä½¿ç”¨ç»å¯¹è·¯å¾„**: è‡ªåŠ¨èŽ·å–é¡¹ç›®è·¯å¾„ï¼Œè·¨çŽ¯å¢ƒå…¼å®¹

## å›¢é˜Ÿä½¿ç”¨

### æ–¹æ¡ˆä¸€ï¼šæ¯ä¸ªäººæœ¬åœ°å®‰è£…

æ¯ä¸ªå¼€å‘è€…åœ¨è‡ªå·±çš„æœºå™¨ä¸Šï¼š
1. å¯åŠ¨ AI CR æœåŠ¡
2. å®‰è£… Git Hooks

### æ–¹æ¡ˆäºŒï¼šå…±äº«æœåŠ¡

1. åœ¨å›¢é˜ŸæœåŠ¡å™¨ä¸Šéƒ¨ç½² AI CR æœåŠ¡
2. ä¿®æ”¹ hook ä¸­çš„ URL: `http://your-server:8083`
3. å›¢é˜Ÿæˆå‘˜åªéœ€å®‰è£… hooks

## ç¤ºä¾‹è¾“å‡º

### commit æ—¶ï¼ˆå¿«é€Ÿé€šè¿‡ï¼‰

```bash
$ git commit -m "fix: ä¿®å¤ç™»å½•é—®é¢˜"
[main abc1234] fix: ä¿®å¤ç™»å½•é—®é¢˜
 2 files changed, 10 insertions(+), 5 deletions(-)
```

### push æ—¶ï¼ˆä¸¥æ ¼å®¡æŸ¥ï¼‰

```bash
$ git push origin main

ðŸš€ AI Code Review - æŽ¨é€å‰ä¸¥æ ¼æ£€æŸ¥...
ðŸ“ å‘çŽ°æœªæŽ¨é€çš„æäº¤:
abc1234 fix: ä¿®å¤ç™»å½•é—®é¢˜

ðŸ“ é¡¹ç›®è·¯å¾„: /Users/chenyuhang/GolandProjects/safe-user-center
ðŸ“ å˜æ›´çš„æ–‡ä»¶:
controller/login.go

ðŸ” èŽ·å–ä»£ç å˜æ›´...
ðŸ“Š ä»£ç å˜æ›´å¤§å°: 856 å­—ç¬¦

ðŸ” AI å®¡æŸ¥ä¸­ï¼ˆåªå®¡æŸ¥æœ¬æ¬¡ä¿®æ”¹çš„ä»£ç ï¼‰...

ðŸ“‹ AI å®¡æŸ¥ç»“æžœ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ä»£ç å®¡æŸ¥æŠ¥å‘Š

### æœ¬æ¬¡ä¿®æ”¹å®¡æŸ¥

**controller/login.go**

1. **ç¬¬177è¡Œ** - é”™è¯¯å¤„ç†æ”¹è¿›
   ```diff
   - return err
   + if err != nil {
   +     logger.Error(ctx, "error", err)
   +     return util.NewError(500, "internal error")
   + }
   ```
   - âœ… æ­£ç¡®æ·»åŠ äº†æ—¥å¿—è®°å½•
   - âš ï¸  å»ºè®®ï¼šé”™è¯¯ç  500 åº”è¯¥ä½¿ç”¨å¸¸é‡

2. **ç¬¬234è¡Œ** - æ·»åŠ äº† err æ£€æŸ¥
   - âœ… æ”¹è¿›äº†é”™è¯¯å¤„ç†

### æ€»ç»“
æœ¬æ¬¡ä¿®æ”¹æ•´ä½“è´¨é‡è‰¯å¥½ï¼Œå»ºè®®å°†ç¡¬ç¼–ç çš„é”™è¯¯ç æ”¹ä¸ºå¸¸é‡ã€‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… AI å®¡æŸ¥é€šè¿‡ï¼Œå…è®¸æŽ¨é€
```

### å‘çŽ°ä¸¥é‡é—®é¢˜æ—¶

```bash
âŒ å‘çŽ°ä¸¥é‡é—®é¢˜ï¼Œä¸å…è®¸æŽ¨é€ï¼

è¯·ä¿®å¤ä»¥ä¸Šé—®é¢˜åŽå†æŽ¨é€ã€‚

å¦‚æžœç¡®è®¤è¦å¼ºåˆ¶æŽ¨é€ï¼Œè¯·è¾“å…¥: FORCE_PUSH
> _
```

## æ•…éšœæŽ’æŸ¥

### commit å¾ˆæ…¢

å¦‚æžœ commit å¾ˆæ…¢ï¼Œå¯èƒ½æ˜¯æ—§ç‰ˆæœ¬çš„ commit-msg hook åœ¨è°ƒç”¨ AIï¼š

```bash
# æŸ¥çœ‹ commit-msg å†…å®¹
cat .git/hooks/commit-msg

# å¦‚æžœåŒ…å« curl è°ƒç”¨ AI çš„ä»£ç ï¼Œæ›´æ–°ä¸ºæ–°ç‰ˆæœ¬
cat > .git/hooks/commit-msg << 'EOF'
#!/bin/bash
exit 0
EOF
chmod +x .git/hooks/commit-msg
```

### Hook ä¸æ‰§è¡Œ
```bash
# æ£€æŸ¥æƒé™
ls -la .git/hooks/
# åº”è¯¥æ˜¾ç¤º -rwxr-xr-x

# å¦‚æžœæ²¡æœ‰æ‰§è¡Œæƒé™
chmod +x .git/hooks/pre-commit
chmod +x .git/hooks/commit-msg
chmod +x .git/hooks/pre-push
```

### push æ—¶æœåŠ¡è¿žæŽ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://localhost:8083/health

# å¦‚æžœå¤±è´¥ï¼Œå¯åŠ¨æœåŠ¡
cd ai-cr && go run main.go server
```

### jq å‘½ä»¤æœªæ‰¾åˆ°
```bash
# macOS
brew install jq

# Linux
sudo apt-get install jq
```

### AI è¯»å–ä¸åˆ°æ–‡ä»¶

çŽ°åœ¨ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œåº”è¯¥ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚å¦‚æžœè¿˜æ˜¯è¯»å–ä¸åˆ°ï¼š

```bash
# æ£€æŸ¥é¡¹ç›®è·¯å¾„
pwd
# è¾“å‡º: /Users/chenyuhang/GolandProjects/safe-user-center

# push æ—¶ä¼šæ˜¾ç¤º
ðŸ“ é¡¹ç›®è·¯å¾„: /Users/chenyuhang/GolandProjects/safe-user-center
```
